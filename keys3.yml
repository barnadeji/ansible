---
- name: Manage SSH keys on remote servers
  hosts: all
  become: yes
  vars:
    ssh_keys:
      - name: "key1"
        key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1..."
      - name: "key2"
        key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD2..."
      - name: "key3"
        key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQEr..."
  tasks:

    - name: List available SSH keys
      debug:
        msg: "{{ item.name }}"
      loop: "{{ ssh_keys }}"

    - name: Add the selected SSH key
      authorized_key:
        user: "{{ username }}"
        state: present
        key: "{{ item.key }}"
      when: item.name == "{{ selected_key }}"
      loop: "{{ ssh_keys }}"

    - name: Remove the selected SSH key
      authorized_key:
        user: "{{ username }}"
        state: absent
        key: "{{ item.key }}"
      when: item.name == "{{ selected_key_remove }}"
      loop: "{{ ssh_keys }}"
